<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CalTrack</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #fafafa; color: #333; }
    h1 { margin-bottom: 20px; color: #035096 }
    h2 { cursor: pointer; background: #f0f0f0; padding: 10px; border-radius: 5px; user-select: none; }
    h2::after { content: ' ▼'; float: right; }
    h2.active::after { content: ' ▲'; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; background: #fff; }
    table, th, td { border: 1px solid #ccc; }
    th { background: #035096; color: #fff; }
    th, td { padding: 8px; text-align: center; }
    tr:nth-child(even) { background: #fdfdfd; }
    tr:nth-child(odd) { background: #b0c4de; }
    .hidden { display: none; }
    .chart-container { width: 100%; max-width: 600px; margin: 20px auto; background: #fff; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <h1>CalTrack</h1>
  <h2 onclick="toggleSection(this, 'dailyLogs')">Daily Logs</h2>
  <div id="dailyLogs">
    <table id="dailyTable">
      <tr>
        <th>Date</th>
        <th>Gross Calories</th>
        <th>Activity Calories</th>
        <th>Net Calories</th>
        <th>Sodium (mg)</th>
        <th>Protein (g)</th>
        <th>Water (L)</th>
      </tr>
    </table>

    <button onclick="addDailyRow()">Add Daily Log</button>
  </div>

  <h2 onclick="toggleSection(this, 'weeklyLogs')">Weekly Check-ins</h2>
  <div id="weeklyLogs">
    <table id="weeklyTable">
      <tr>
        <th>Week</th>
        <th>Date Range</th>
        <th>Goal Weight (kg)</th>
        <th>Actual Weight (kg)</th>
        <th>Goal Met?</th>
        <th>Shortfall (kg)</th>
        <th>Adjustment Suggestion</th>
      </tr>
    </table>
  </div>

  <div class="chart-container">
    <canvas id="progressChart"></canvas>
  </div>


  <script>
    const dailyTable = document.getElementById("dailyTable");
    const weeklyTable = document.getElementById("weeklyTable");

    function addDailyRow() {
      const row = dailyTable.insertRow(-1);
      const date = row.insertCell(0);
      const gross = row.insertCell(1);
      const activity = row.insertCell(2);
      const net = row.insertCell(3);
      const sodium = row.insertCell(4);
      const protein = row.insertCell(5);
      const water = row.insertCell(6);

      date.innerHTML = `<input type='date'>`;
      gross.innerHTML = `<input type='number' oninput='updateNet(this)'>`;
      activity.innerHTML = `<input type='number' oninput='updateNet(this)'>`;
      net.innerHTML = `0`;
      sodium.innerHTML = `<input type='number'>`;
      protein.innerHTML = `<input type='number'>`;
      water.innerHTML = `<input type='number' step='0.1'>`;
    }

    function updateNet(element) {
      const row = element.parentElement.parentElement;
      const gross = parseFloat(row.cells[1].children[0].value) || 0;
      const activity = parseFloat(row.cells[2].children[0].value) || 0;
      row.cells[3].innerText = gross - activity;
    }

    function toggleSection(header, id) {
      const section = document.getElementById(id);
      section.classList.toggle("hidden");
      header.classList.toggle("active");
    }

    const weeklyGoals = [
      { week: 1, range: "Sept 11–17", goal: 59.4 },
      { week: 2, range: "Sept 18–24", goal: 58.8 },
      { week: 3, range: "Sept 25–Oct 1", goal: 58.2 },
      { week: 4, range: "Oct 2–8", goal: 57.6 },
      { week: 5, range: "Oct 9–15", goal: 57.0 },
      { week: 6, range: "Oct 16–22", goal: 56.4 },
      { week: 7, range: "Oct 23–29", goal: 55.8 },
      { week: 8, range: "Oct 30–Nov 5", goal: 55.2 },
      { week: 9, range: "Nov 6–12", goal: 54.6 },
      { week: 10, range: "Nov 13–19", goal: 54.0 },
      { week: 11, range: "Nov 20–26", goal: 53.4 },
      { week: 12, range: "Nov 27–Dec 3", goal: 52.8 },
      { week: 13, range: "Dec 4–11", goal: 52.0 }
    ];

    const targetData = weeklyGoals.map(g => g.goal);
    let actualData = new Array(weeklyGoals.length).fill(null)

    function buildWeeklyTable() {

      weeklyGoals.forEach((g, i) => {
        const row = weeklyTable.insertRow(-1);
        row.insertCell(0).innerText = g.week;
        row.insertCell(1).innerText = g.range;
        row.insertCell(2).innerText = g.goal;
        row.insertCell(3).innerHTML = `<input type='number' step='0.1' onchange='updateWeekly(${i}, this)'>`;
        row.insertCell(4).innerText = "-";
        row.insertCell(5).innerText = "-";
        row.insertCell(6).innerText = "-";
      });
    }

    function updateWeekly(index, input) {
      const actual = parseFloat(input.value);
      const goal = weeklyGoals[index].goal;
      const row = input.parentElement.parentElement;
      if (!isNaN(actual)) {
        actualData[index] = actual;
        if (actual <= goal) {
          row.cells[4].innerText = "Yes";
          row.cells[5].innerText = "0";
          row.cells[6].innerText = "Maintain plan";
        } else {
          const shortfall = (actual - goal).toFixed(1);
          row.cells[4].innerText = "No";
          row.cells[5].innerText = shortfall;
          row.cells[6].innerText = "Cut ~100-150 kcal/day or +1-2k steps";
        }

        updateChart();
      }
    }
    let chart;
    function updateChart() {
      if (chart) chart.destroy();
      const ctx = document.getElementById('progressChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: weeklyGoals.map(g => `W${g.week}`),
          datasets: [
            {
              label: 'Target Weight',
              data: targetData,
              borderColor: 'blue',
              fill: false
            },
            {

              label: 'Actual Weight',
              data: actualData,
              borderColor: 'red',
              fill: false,
              pointBackgroundColor: actualData.map((val, i) => {
                if (val === null) return 'red';
                return val > targetData[i] ? 'darkred' : 'green';
              })
            }
          ]

        },

        options: {
          responsive: true,
          plugins: { legend: { position: 'top' } },
          scales: { y: { beginAtZero: false } }
        }

      });
    }

    buildWeeklyTable();
    updateChart();
  </script>
</body>
</html>